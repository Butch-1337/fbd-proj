<!doctype html>
<html lang="ru">
	<head>
		<link rel="stylesheet" href="css/main.css" />	
	</head>
	<body>
	<div id="content">	
	  <div class="ui-draggable" id="block1">
		<div class="block-name"> 1/0 </div>
		<div class="out" id="b1out" onclick="mouseoverHandler(event)">0</div>
		<button onclick="init('b1out')">1/0</button>
	  </div>
	  <div class="ui-draggable" id="block2">
		<div class="block-name"> 1/0 </div>
		<div class="out" id="b2out" onclick="mouseoverHandler(event)">0</div>
		<button onclick="init('b2out')" >1/0</button>
	  </div>
	  <div class="ui-draggable" id="block3">
		<div class="block-name"> & </div>
		<div class="in in1" id="b3in1" onclick="p2pArrow(this.id)"></div>
		<div class="in in2" id="b3in2" onclick="p2pArrow(this.id)"></div>
		<div class="out" id="b3out"></div>
	  </div>

	</div>

	</body>
		<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script> -->
		<script src="lib/jquery-1.5.min.js"></script>
		<script src="lib/jquery-ui.min.js"></script>
		<script src="lib/arrows.1.0.0.js"></script>
		<script>	
		  // Определим «общего родителя», на котором будут рисоваться стрелки (создаваться холст – canvas)
		  var arrowsDrawer1 = $cArrows('#content');
		  var arrowsDrawer2 = $cArrows('#content');
		  var oId; 
		  var i1 = document.getElementById("b3in1").innerHTML;
		  var i2 = document.getElementById("b3in2").innerHTML;;
			
			// Обработчик для mouseover
			function mouseoverHandler(event) {
				event = event || window.event;
				var relatedTarget = event.relatedTarget || event.fromElement;
				oId = event.target.id;
				// для mouseover
				// relatedTarget - элемент, с которого пришел курсор мыши
			}
			
			
			function p2pArrow(p2) {
				/*if (oId == "b1out"){
					arrowsDrawer1.arrow('#'+oId, '#'+p2,
					{ arrow: { connectionType: 'side', sideFrom: 'right', sideTo: 'left'}});
					if (p2 == "b3in1") i1 = 1;
					if (p2 == "b3in2") i2 = 1;
				}*/
				if (oId == "b1out"){
					if (p2 == "b3in1" && i1 != 1) {
						arrowsDrawer1.arrow('#'+oId, '#'+p2,
						{ arrow: { connectionType: 'side', sideFrom: 'right', sideTo: 'left'}});
						i1 = 1;
					}
					if (p2 == "b3in2" && i2 != 1) {
						arrowsDrawer1.arrow('#'+oId, '#'+p2,
						{ arrow: { connectionType: 'side', sideFrom: 'right', sideTo: 'left'}});
						i2 = 1;
					}
				}
				if (oId == "b2out"){
					if (p2 == "b3in1" && i1 != 1) {
						arrowsDrawer2.arrow('#'+oId, '#'+p2,
						{ arrow: { connectionType: 'side', sideFrom: 'right', sideTo: 'left'}});
						i1 = 1;
					}
					if (p2 == "b3in2" && i2 != 1) {
						arrowsDrawer2.arrow('#'+oId, '#'+p2,
						{ arrow: { connectionType: 'side', sideFrom: 'right', sideTo: 'left'}});
						i2 = 1;
					}
					
				}
			}
			
			function andbl(id1,id2) {
				var bv1 = document.getElementById(id1).innerHTML;
				var bv2 = document.getElementById(id2).innerHTML;	
				document.getElementById("b3out").innerHTML = Number(bv1) && Number(bv2);
			}
			
			function chColor(outId) {
				var bc = document.getElementById(outId);
				var bv = document.getElementById(outId).innerHTML;		
				if (bv == 0) {
				  bc.style.background = 'red';
				  switch (outId){
				  case "b1out": 
				  arrowsDrawer1.updateOptions(
				  { render: {strokeStyle:'red'}})
				  arrowsDrawer1.redraw();
				  break;
				  case "b2out":
				  arrowsDrawer2.updateOptions(
				  { render: {strokeStyle:'red'}})
				  arrowsDrawer2.redraw();
				  break;
				  }
				}
				else {
				  bc.style.background = 'green';
				  switch (outId){
				  case "b1out": 
				  arrowsDrawer1.updateOptions(
				  { render: {strokeStyle:'green'}})
				  arrowsDrawer1.redraw();
				  break;
				  case "b2out":
				  arrowsDrawer2.updateOptions(
				  { render: {strokeStyle:'green'}})
				  arrowsDrawer2.redraw();
				  break;
				  }
				} 
			}
		  //window.alert (Number(bv1) && Number(bv2));		  
		  
		  function init(outId){
			  var bv = document.getElementById(outId).innerHTML;
			  if (bv == 0) {
				  bv = 1;
			  }
			  else {
				bv = 0;
			  }				
			  document.getElementById(outId).innerHTML = bv;
			  chColor(outId);
			  if (i1==1 && i2==1){
				andbl("b1out","b2out");
				chColor("b3out");
			  } 
		  }
		     
		  // Рисуем стрелки .arrow(from, to)
		  /*arrowsDrawer1.arrow('#block1 .out', '#block3 .in1',
		  { arrow: { connectionType: 'side', sideFrom: 'right', sideTo: 'left'}});
		  arrowsDrawer2.arrow('#b2out', '#b3in2',
		  { arrow: { connectionType: 'side', sideFrom: 'right', sideTo: 'left'}});*/
		  
		  // Перерисовка при перемещении с jQuery Ui
		  $(function() {
			$( "#content .ui-draggable" ).draggable({
			  containment: "#content",
			  scroll: false,
			  cursor: 'move',
			  drag: function( event, ui ) {
				arrowsDrawer1.redraw();
				arrowsDrawer2.redraw();
			  }
			});			
		  });
		  
		</script>
</html>

























